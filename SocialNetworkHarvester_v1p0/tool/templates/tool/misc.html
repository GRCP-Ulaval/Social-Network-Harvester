{% load staticfiles %}
{% load extratags %}

{% if tool == "gridDisplay" %}
<div class="grid">
    {% autoescape off %}
        {{ item|getFieldsValuesAsTiles:currentUser }}
    {% endautoescape %}
</div>
{% endif %}


{% if tool == "gridDisplayItem" %}
{% autoescape off %}
<div class="tooltip grid-item {{ field.extra_class }}" {{ field.extra_features }}>

    {% if field.type == "date" %}
    <div class='value date_value'>
        <span>{{ field.value }}</span>
    </div>
    {% elif field.type == "long_string" %}
    <div class='value string_value'>
        <span>{{ field.strValue }}</span>
    </div>
    {% elif field.type == 'html_link' %}
    <div class='value html_link_value'>
        <span>{{ field.strValue }}</span>
    </div>
    {% elif field.type == 'embedded_content' %}
    <div class='value embedded_content_value'>
        <span>{{ field.strValue }}</span>
    </div>

    {% elif field.type == "integer" %}
    <div class='value integer_value'>
        {% if field.strValue|length >= 15 %}
        <span style=" font-size:8px;">
        {% elif field.strValue|length >= 13 %}
        <span style=" font-size:9px;">
        {% elif field.strValue|length >= 11 %}
        <span style=" font-size:10px;">
        {% elif field.strValue|length >= 9 %}
        <span style=" font-size:12px;">
        {% else %}
        <span style=" font-size:18px;">
        {% endif %}
            {{ field.strValue|truncatechars:75 }}
        </span>
    </div>

    {% elif field.type == "boolean" %}
    <div class='value boolean_value'>
        {% if field.strValue == "False" %} <span style='color:red'>Non</span>
        {% elif field.strValue == "True" %} <span style='color:green'>Oui</span>
        {% endif %}
    </div>

    {% elif field.type == "short_string" or field.type == "link_url" %}
    <div class='value string_value'>
        {% if field.strValue|length >= 60 %}
        <span style=" font-size:8px;">
        {% elif field.strValue|length >= 30 %}
        <span style=" font-size:10px;">
        {% elif field.strValue|length >= 9 %}
        <span style=" font-size:12px;">
        {% else %}
        <span style=" font-size:18px;">
        {% endif %}
            {% if field.type == "link_url" %}
            <a href='{{ field.value }}' class='TableToolLink' target='_blank'>{{ field.value|truncatechars:40 }}</a>
            {% else %}
            {{ field.strValue|truncatechars:40 }}
            {% endif %}
        </span>
    </div>

    {% elif field.type == "image_url" %}
    <div class="popup" id="imageBigDisplayPopup">
        <div id="title">{{ field.name }}</div>
        <div id="help">{{ field.description }}</div>
        <div id="content">
            <img class="imageBigDisplay" src="{{ field.strValue }}"></img>
        </div>
        <script id="functions"></script>
    </div>

    <div class='value image_value'></div>

    {% elif field.type == "object"%}
    <div class='value object_value'>
        <span>
            <a href='{{ field.value.getLink }}' class='TableToolLink'>{{ field.value }}</a>
        </span>
    </div>

    {% elif field.type == "object_list"%}
    <div class='value object_list_value'>
        <span><ul>
            {% with field.value.all as values %}
            {% for val in values %}
                <li><a href='{{ val.getLink }}' class='TableToolLink'>{{ val }}</a></li>
            {% endfor %}
            {% endwith %}
        </ul></span>
    </div>

    {% endif %}
    {% if not "no_field_name" in field.extra_class %}
    <div class='fieldName'>
        {% if field.name|length >= 30 %}
            <span style=" font-size:8px;">
        {% elif field.name|length >= 20 %}
            <span style=" font-size:9px;">
        {% elif field.name|length >= 10 %}
            <span style=" font-size:12px;">
        {% else %}
            <span>
        {% endif %}
        {{ field.name }}</span>
    </div>
    {% endif %}
    <span class="tooltiptext">{{ field.description }}</span>
</div>
{% endautoescape %}



{% elif tool == "addRemoveFromList" %}
{% if item in list %}
<span class="document_title document_menu" title="Retirer de ma liste de collecte"
    style="background-color : rgba(0, 222, 0, 0.85);">
    <a onclick=displayCenterPopup("removeFromList") >
        {% include "tool/icons.html" with x=5 y=5 style='height:15px;width:15px;vertical-align:middle'%}
        Ajouté à ma liste
    </a>
</span>
<div class="popup" id="removeFromList">
    <div id="title">Retirer de la liste</div>
    <div id="help">
        Retrait de <b>{{ item }}</b>
    </div>
    <div id="content">
        <center>
            Voulez-vous retirer <br><br>
            <b>{{ item }}</b><br><br>
            de votre liste de collecte Aspira?<br><br>
        </center>
        <div style="width:300px; height:30px;">
            <input type="button" class="cancelButton" value="Annuler" onclick="cancelOperation()">
            <input type="button" class="submitButton" value="Retirer" onclick="submitOperation(false)">
        </div>
    </div>
{% else %}

<span class="document_title document_menu" title="Ajouter à ma liste de collecte">
    <a onclick=displayCenterPopup("addToList") >
        {% include "tool/icons.html" with x=4 y=5 style='height:15px;width:15px;vertical-align:middle'%}
        Ajouter à ma liste
    </a>
</span>
<div class="popup" id="addToList">
    <div id="title">Ajouter à ma liste</div>
    <div id="help">
        Ajout de <b>{{ item }}</b>
    </div>
    <div id="content">
        <center>
            Voulez-vous ajouter <br><br>
            <b>{{ item }}</b><br><br>
            à votre liste de collecte Aspira?<br><br>
        </center>
        <div style="width:300px; height:30px;">
            <input type="button" class="cancelButton" value="Annuler" onclick="cancelOperation()">
            <input type="button" class="submitButton" value="Ajouter" onclick="submitOperation(true)">
        </div>
    </div>
{% endif %}

    <script id="functions">
        function cancelOperation(){
            closeCenterPopup();
        }
        function submitOperation(addItem){
            var url = "/user/forms/manageHarvestList/";
            if (addItem){
                url += "add";
            }else{
                url += "remove";
            }
            $.post(url,{
                "id":"{{ item.pk }}",
                "list":"{{ listName }}",
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            }, function(response){
                closeCenterPopup();
                if (response['message'] != null){
                    displayNewMessages(response['message']['message'])
                } else if (response['error'] != null){
                    displayNewErrors(response['error']['reason'])
                }
                setTimeout(function(){location.reload()}, 1500);
            });
        }
    </script>
</div>
{% endif %}



