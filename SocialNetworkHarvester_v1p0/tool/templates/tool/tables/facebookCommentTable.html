{% load staticfiles %}
{% load extratags %}


<section class="tableContainer">

{% if source == "facebookBase" %}
    <div class="">
    <div class="section_menu">
            <span class="section_title">
                <b>Commentaires collectés</b>
            </span>
        <div class="section_options">
            {% include "tool/tables/tableMenuItems.html" with name="downloadFields" className="FBComment" filename="Harvested_Facebook_Comments" %}
            {% include "tool/tables/tableMenuItems.html" with name="reloadTable" %}
        </div>
        {% include "tool/tables/tableMenuItems.html" with name="openCloseIcon" %}
    </div>
    <div class="section_content">
        <table class="display" id="FBCommentTable" width="100%" drawn='False'>
            <script class="tableVars">
                var dynamic=true;
                var languageParams = {
                    "emptyTable":"Aucune données disponibles. Sélectionnez une source dans une des tables ci-haut.",
                    "zeroRecords": "Aucune données disponibles. Sélectionnez une source dans une des tables ci-haut.",
                };
                var modelName = "FBComment";
                var srcs = [
                    {
                        modelName: "FBPost",
                        attr: "fbComments",
                        tableId: "FBPostTable",
                        //id            : "{{ item.pk }}"
                    }
                ]
                var columns = [
                    {
                        "searchable": false,
                        "colStr":"Auteur",
                        "fields":["from_profile__pk"],
                        "render": function (data, type, row) {
                            if (row['from_profile__pk',"from_profile__getLink","from_profile__getStr"] == null) {
                                return "<i>Indéfini</i>"
                            };
                            return tableToolLink(row['from_profile__getLink'],
                                    truncate_text(row["from_profile__getStr"], 30, true));
                        }
                    },
                    {
                        "searchable": false,
                        "colStr":"Création",
                        "fields": ["created_time"],
                        "render": function (data, type, row) {
                            if (row['created_time'] == null) {
                                return "<i>Indéfini</i>"
                            };
                            return row['created_time'];
                        }
                    },
                    {
                        "colStr":"Message",
                        "fields": ["message"],
                        "render": function (data, type, row) {
                            if (row['message'] == null) {
                                return "<i>Pas de message</i>"
                            };
                            return truncate_text(row['message'],100,true);
                        }
                    },
                    {
                        "colStr":"Status parent",
                        "searchable": false,
                        "orderable": false,
                        "fields": ["parentPost__getStr"],
                        "render": function (data, type, row) {
                            if (row['parentPost__getStr'] == null) {
                                return "<i>Indéfini</i>"
                            };
                            return tableToolLink("/facebook/post/"+row['parentPost__pk'],
                                    truncate_text(row["parentPost__getStr"], 40, true));
                        }
                    },
                    {
                        "colStr":"Réponses",
                        "searchable": false,
                        "fields": ["comment_count"],
                        "render": function (data, type, row) {
                            if (row['comment_count'] == null) {
                                return ""
                            };
                            return "<center>" + row['comment_count'] + "</center>";
                        }
                    },
                    {
                        "colStr":"Likes",
                        "searchable": false,
                        "fields": ["like_count"],
                        "render": function (data, type, row) {
                            if (row['like_count'] == null) {
                                return ""
                            };
                            return "<center>" + row['like_count'] + "</center>";
                        }
                    },
                    {
                        "searchable": false,
                        "orderable": false,
                        "fields": ["pk"],
                        "render": function (data, type, row) {
                            if (row['pk'] == null) {
                                return '<i>indéfini</i>'
                            } else {
                                return tableToolLink("/facebook/comment/"+row['pk'],"Plus d'infos");
                            }
                        }
                    },
                ]
            </script>
        </table>
    </div>
</div>

{% elif source == "statusComments" %}
    <div class="">
        <div class="section_menu">
            <span class="section_title">
                <b>Commentaires</b>
            </span>
            <div class="section_options">
                {% include "tool/tables/tableMenuItems.html" with name="downloadFields" className="FBComment" filename="Harvested_Facebook_Comments" %}
                {% include "tool/tables/tableMenuItems.html" with name="reloadTable" %}
            </div>
            {% include "tool/tables/tableMenuItems.html" with name="openCloseIcon" %}
        </div>
        <div class="section_content">
            <table class="display" id="FBPostCommentTable" width="100%" drawn='False'>
                <thead>
                <tr>
                    <th><input type="checkbox" class='table_select_master'></th>
                    <th>Auteur</th>
                    <th>Création</th>
                    <th>Message</th>
                    <th>Réponses</th>
                    <th>Likes</th>
                    <th></th>
                </tr>
                </thead>
                <script class="tableVars">
                    var fields = "from_profile__pk,created_time,message,comment_count,like_count,from_profile__getLink,from_profile__getStr,pk";
                    var url = "/facebook/ajax?tableId=FBPostCommentTable&fbPostId={{ fbPost.pk }}";
                    var columnsDefs = [
                        {
                            "orderable": false,
                            "searchable": false,
                            "className": 'select-checkbox',
                            "targets": 0,
                            "render": function () {
                                return ""
                            }
                        },
                        {
                            "targets": 1,
                            "searchable": false,
                            "asSorting": default_asSorting,
                            "render": function (data, type, row) {
                                if (row['from_profile__pk'] == null) {
                                    return "<i>Indéfini</i>"
                                };
                                return '<a href="'+row['from_profile__getLink']+'" class="TableToolLink">'+
                                        truncate_text(row["from_profile__getStr"],30,true)+'</a>'
                            }
                        },
                        {
                            "targets": 2,
                            "searchable": false,
                            "asSorting": default_asSorting,
                            "render": function (data, type, row) {
                                if (row['created_time'] == null) {
                                    return "<i>Indéfini</i>"
                                };
                                return row['created_time'];
                            }
                        },
                        {
                            "targets": 3,
                            "searchable": true,
                            "asSorting": default_asSorting,
                            "render": function (data, type, row) {
                                if (row['message'] == null) {
                                    return "<i>Pas de message</i>"
                                };
                                return truncate_text(row['message'],100,true);
                            }
                        },
                        {
                            "targets": 4,
                            "searchable": false,
                            "asSorting": default_asSorting,
                            "render": function (data, type, row) {
                                if (row['comment_count'] == null) {
                                    return ""
                                };
                                return "<center>" + row['comment_count'] + "</center>";
                            }
                        },
                        {
                            "targets": 5,
                            "searchable": false,
                            "asSorting": default_asSorting,
                            "render": function (data, type, row) {
                                if (row['like_count'] == null) {
                                    return ""
                                };
                                return "<center>" + row['like_count'] + "</center>";
                            }
                        },
                        {
                            "targets": 6,
                            "searchable": false,
                            "orderable": false,
                            "render": function (data, type, row) {
                                if (row['pk'] == null) {
                                    return '<i>indéfini</i>'
                                } else {
                                    return '<a href="/facebook/comment/'+row['pk']+'" class="TableToolLink">Plus d\'infos</a>';
                                }
                            }
                        },
                    ]
                </script>
            </table>
        </div>
    </div>

{% endif %}
</section>