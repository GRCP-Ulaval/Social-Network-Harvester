{% extends "MainPage.html" %}
{% load staticfiles %}

{% block Title %}SNH | Twitter{% endblock %}

{% block extendHead %}
    <link rel="stylesheet" type="text/css" href='{% static "css/table_style.css" %}' name="style">
    <script type="text/javascript" src='{% static "js/table_script.js" %}'></script>
{% endblock %}

{% block content %}
<section class="overviewContainer yetToCome">
    <div class="section_menu">
        <span class="section_title">
            <b>Overview</b>
        </span>
    </div>
    <div class="section_overview_content">
        -- STATISTIQUES DIVERSES --
    </div>
</section>

<!-- USERS -->
<section class="tableContainer">
    <div class="section_menu">
        <span class="section_title">
            <b>Harvested Users</b>
        </span>
        <div class="section_options">
            <span>|</span>
            <span id="new_user" class="section_menuItem">New</span>
            <span>|</span>
            <span id="delete_user" class="section_menuItem">Delete</span>
            <span>|</span>
            <span id="add_to_group" class="section_menuItem">Add to group</span>
            <span>|</span>
            <span id="downloadAllUsers" class="section_menuItem">Download selection</span>
            <span>|</span>
            <span id="reloadTableLink" class="section_menuItem">Reload table</span>
        </div>
        <div class="tableOpenCloseIcon" type="plus">
            <img src="{% static 'medias/plus_icon_128.png' %}" style="height:100%;">
        </div>
    </div>

    <div class="section_content">
        <table class="display" id="twUser_table" width="100%" drawn='False'>
            <thead>
                <tr>
                    <th><input type="checkbox" class='table_select_master'></input></th>
                    <th>Name</th>
                    <th>Screen Name</th>
                    <th>Follower count</th>
                    <th>Friend count</th>
                    <th>Status count</th>
                    <th>Location</th>
                </tr>
            </thead>
            <script class="tableVars">
                var fields = "name,screen_name,followers_count,friends_count,statuses_count,location";
                var url = "/twitter/TWUserTable/{{user.id}}/";
                var columnsDefs = [
                    {
                        "orderable": false,
                        "searchable": false,
                        "className": 'select-checkbox',
                        "targets":   0,
                        "render":function(){return ""}
                    },
                    {
                        "targets":   1,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['name'] == null){return '<i>undefined</i>'}
                            else {return row['name']};
                        }
                    },
                    {
                        "targets":   2,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['screen_name']==null){return '<i>undefined</i>'} else {
                                return '<a href="/twitter/user/' + row['screen_name'] + '" class="TableToolLink snippetHover">' + row['screen_name'] + '</a>';
                            }
                        }
                    },
                    {
                        "targets":   3,
                        "searchable": false,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['followers_count'] == null){return '<i>undefined</i>'}
                            else {return row['followers_count']};
                        }
                    },
                    {
                        "targets":   4,
                        "searchable": false,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['friends_count'] == null){return '<i>undefined</i>'}
                            else {return row['friends_count']};
                        }
                    },
                    {
                        "targets":   5,
                        "searchable": false,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['statuses_count'] == null){return '<i>undefined</i>'}
                            else {return row['statuses_count']};
                        }
                    },
                    {
                        "targets":   6,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['location'] == ''){return '<i>undefined</i>'}
                            else {return row['location']};
                        }
                    },
                ]
            </script>
        </table>
    </div>
</section>

<!-- HASHTAGS -->
<section class="tableContainer">
    <div class="section_menu">
        <span class="section_title">
            <b>Harvested Hashtags</b>
        </span>
        <div class="section_options">
            <span>|</span>
            <span id="new_user" class="section_menuItem">New</span>
            <span>|</span>
            <span id="delete_user" class="section_menuItem">Delete</span>
            <span>|</span>
            <span id="add_to_group" class="section_menuItem">Add to group</span>
            <span>|</span>
            <span id="downloadAllHashtags" class="section_menuItem">Download selection</span>
            <span>|</span>
            <span id="reloadTableLink" class="section_menuItem">Reload table</span>
        </div>
        <div class="tableOpenCloseIcon" type="plus">
            <img src="{% static 'medias/plus_icon_128.png' %}" style="height:100%;">
        </div>
    </div>

    <div class="section_content">
        <table class="display" id="twHashtags_table" width="100%" drawn='False'>
            <thead>
                <tr>
                    <th><input type="checkbox" class='table_select_master'></input></th>
                    <th>Term</th>
                    <th>Hit count</th>
                    <th>Harvest since</th>
                    <th>Harvest until</th>
                </tr>
            </thead>
            <script class="tableVars">
                var fields = "hashtag__term,hashtag__hit_count,_harvest_since,_harvest_until";
                var url = "/twitter/TWHashtagTable/{{user.id}}/";
                var columnsDefs = [
                    {
                        "orderable": false,
                        "className": 'select-checkbox',
                        "targets":   0,
                        "render":function(){return ""}
                    },
                    {
                        "targets":   1,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            return '<a href="/twitter/hashtag/'+row['hashtag__term']+'" class="TableToolLink">'+row['hashtag__term']+'</a>';
                        }
                    },
                    {
                        "targets":   2,
                        "orderable": false,
                        "render":function(data,type,row){
                            return row['hashtag__hit_count'];
                        }
                    },
                    {
                        "targets": 3,
                        "asSorting": default_asSorting,
                        "render": function (data, type, row) {
                            return row['_harvest_since'];
                        }
                    },
                    {
                        "targets": 4,
                        "asSorting": default_asSorting,
                        "render": function (data, type, row) {
                            return row['_harvest_until'];
                        }
                    },
                ]
            </script>
        </table>
    </div>
</section>

<!-- TWEETS -->
<section class="tableContainer">
    <div class="section_menu">
        <span class="section_title">
            <b>Tweets</b>
        </span>
        <div class="section_options">
            <span>|</span>
            <span id="downloadAllTweets" class="section_menuItem">Download selection</span>
            <span>|</span>
            <span id="reloadTableLink" class="section_menuItem">Reload table</span>
            <span>|</span>
            <span><input type="checkbox" name="exclude_retweets" class="option_checkbox"> Exclude retweets</span>
        </div>
        <div class="tableOpenCloseIcon" type="plus">
            <img src="{% static 'medias/plus_icon_128.png' %}" style="height:100%;">
        </div>
    </div>

    <div class="section_content">
        <table class="display" id="tweet_table" width="100%" drawn='False'>
            <thead>
                <tr>
                    <th><input type="checkbox" class='table_select_master'></input></th>
                    <th>Date</th>
                    <th>Author</th>
                    <th>Text</th>
                    <th>Retweets</th>
                    <th></th>
                </tr>
            </thead>
            <script class="tableVars">
                var fields = "created_at,user,text,retweet_count,_ident";
                var dynamicSource=true;
                var url="/twitter/TWTweetTable/";
                var languageParams = {
                        "zeroRecords": "Select some rows in the tables above, then reload this table.",
                        "thousands":",",
                    };
                var columnsDefs = [
                    {
                        "orderable": false,
                        "className": 'select-checkbox',
                        "targets":   0,
                        "render":function(){return ""}
                    },
                    {
                        "targets":   1,
                        "searchable": false,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['created_at'] == null) {return "<i>undefined</i>"}
                            return row['created_at'];
                        }
                    },
                    {
                        "targets":   2,
                        "searchable": true,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if (row['user'] == null) {return "<i>undefined</i>"}
                            return '<a href="/twitter/user/'+row['user']+'" class="TableToolLink snippetHover">'+row['user']+'</a>';
                        }
                    },
                    {
                        "targets":   3,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            var text = row['text'];
                            if (text == null) {return "<i>undefined</i>"}
                            var urlRegex = /https?:\/\/t\.co\/([A-Z]|[0-9])+/i;
                            var url = text.match(urlRegex);
                            var userRegex = /@([A-Z]|[0-9]|_)+/i;
                            var username = text.match(userRegex);
                            if(url != null){url = url[0]};
                            text =  text.replace(urlRegex, '<a class="TableToolLink" target="_blank" href="'+url+'">'+url+'</a>');
                            if (username != null){
                                username = username[0];
                                text =  text.replace(userRegex, '<a class="TableToolLink" target="_blank" href="twitter/user/'+username.slice(1)+'">'+username+'</a>');
                            }
                            return text;
                        }
                    },
                    {
                        "targets":   4,
                        "asSorting": default_asSorting,
                        "render":function(data,type,row){
                            if(row['retweet_count']==null) {return "<i>undefined</i>"}
                            return row['retweet_count'];
                        }
                    },
                    {
                        "targets":   5,
                        "searchable": false,
                        "orderable": false,
                        "render":function(data,type,row){
                            return '<a href="/twitter/tweet/'+row["_ident"]+'" class="TableToolLink">'+'more infos'+'</a>';
                        }
                    },
                ];
            </script>
        </table>
    </div>
</section>
{% endblock %}






























































