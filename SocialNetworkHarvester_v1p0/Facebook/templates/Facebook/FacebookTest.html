<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">


<HTML>
    <HEAD>
        {% load staticfiles %}

        <script type="text/javascript" src='{% static "js/script_facebook.js" %}'></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <TITLE>
            A Small Hello 
        </TITLE>
    </HEAD>
<BODY>
    <H1>Hi</H1>
    <P>This is very minimal "hello world" HTML document.</P> 

     <script type="text/javascript">
        function fbUserSelect(id, searchType){
            if (FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    if (searchType == 'page'):
                        continue

                    document.getElementById("fbUserSearchResults").innerHTML = "";
                    FB.api(
                        id + "?fields=name,id,picture" + (searchType === 'user' || searchType === 'page' ? ',is_verified' : ''),
                        function (response) {
                            var selectDiv = document.getElementById("fbUserSelected");
                            var html = "<img height='50' width='50' alt='profile picture' src='" + response.picture.data.url + "'>" + (response.is_verified === true ? "<img src='{% static 'medias/facebook_verified_icon_150.png' %}' height='25' width='25' alt='verified'>" : "") + response.name + ", " + response.id;

                            selectDiv.innerHTML = selectDiv.innerHTML + "<p id='" + response.id + "'>" + html + "</p>";
                        }
                    );
                }
            }));
        }

        function fbUserSearch() {
            if (FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    var searchDiv = document.getElementById("fbUserSearchResults");
                    searchDiv.innerHTML = "";
                    var searchType = "";
                    [].slice.call(document.getElementsByTagName("input")).filter(
                        function(element){
                            return element.name === "searchType";
                        }
                    ).forEach(
                        function(item, index){
                            if (item.checked){
                                searchType = item.value;
                            }
                        }
                    );
                    var name = [].slice.call(document.getElementsByTagName("input")).filter(
                        function(element){
                            return element.name === "nameToSearch";
                        })[0].value;
                    console.log(name);
                    FB.api(
                        "search?limit=5&type=" + searchType + "&q=" + name,
                        function(response){
                            if (response && !response.error) {
                                console.log(response);
                                response.data.forEach(function(item, index){
                                    FB.api(
                                        item.id + "?fields=name,id,picture" + (searchType === "user" || searchType === "page" ? ",is_verified" : "" ),
                                        function(response){
                                            if (response && !response.error){
                                                console.log(response);
                                                var html = "<img height='50' width='50' alt='profile picture' src='" + response.picture.data.url + "'>" + (response.is_verified === true ? "<img src='{% static 'medias/facebook_verified_icon_150.png' %}' height='25' width='25' alt='verified'>" : "") + response.name + ", " + response.id;

                                                searchDiv.innerHTML = searchDiv.innerHTML + "<p><a href='javascript:fbUserSelect(" + response.id + ", \"" + searchType + "\");'>" + html + "</a></p>";
                                            }
                                            else{
                                                console.log(response);
                                            }
                                        }
                                    );
                                });
                            }
                            else {
                                console.log(response);
                            }
                        }
                    );
                }
            }));
            return false;
        }
    </script>


    <form id="fbUserSearch" action="javascript:fbUserSearch();">
        <input type="text" name="nameToSearch" placeholder="screen_name" value="" required><br>
        <input type="radio" name="searchType" value="user" required> Users<br>
        <input type="radio" name="searchType" value="page" required> Pages<br>
        <input type="radio" name="searchType" value="group" required> Groups<br>
        <input name="submit" type="Submit" value="Search">
    </form>

    <!--<div class="fb-like" data-share="true" data-width="450" data-show-faces="true"></div>-->

    <div id="fbUserSearchResults">
    </div>

    <div id="fbUserSelected">
        <h1>Selected List of users</h1>
    </div>

</BODY>
</HTML>